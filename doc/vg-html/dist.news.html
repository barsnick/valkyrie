<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>4. NEWS</title>
<link rel="stylesheet" href="vg_basic.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="Valgrind Documentation">
<link rel="up" href="dist.html" title="Distribution Documents">
<link rel="previous" href="dist.install.html" title="3. INSTALL">
<link rel="next" href="dist.readme.html" title="5. README">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div><table class="nav" width="100%" cellspacing="3" cellpadding="3" border="0" summary="Navigation header"><tr>
<td width="22px" align="center" valign="middle"><a accesskey="p" href="dist.install.html"><img src="images/prev.png" width="18" height="21" border="0" alt="Prev"></a></td>
<td width="25px" align="center" valign="middle"><a accesskey="u" href="dist.html"><img src="images/up.png" width="21" height="18" border="0" alt="Up"></a></td>
<td width="31px" align="center" valign="middle"><a accesskey="h" href="index.html"><img src="images/home.png" width="27" height="20" border="0" alt="Up"></a></td>
<th align="center" valign="middle">Distribution Documents</th>
<td width="22px" align="center" valign="middle"><a accesskey="n" href="dist.readme.html"><img src="images/next.png" width="18" height="21" border="0" alt="Next"></a></td>
</tr></table></div>
<div class="chapter" lang="en">
<div class="titlepage">
<div><div><h2 class="title">
<a name="dist.news"></a>4. NEWS</h2></div></div>
<div></div>
</div>
<div class="literallayout"><p><br>
      <br>
Stable release 2.4.0 (March 2005) -- CHANGES RELATIVE TO 2.2.0<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
2.4.0 brings many significant changes and bug fixes.  The most<br>
significant user-visible change is that we no longer supply our own<br>
pthread implementation.  Instead, Valgrind is finally capable of<br>
running the native thread library, either LinuxThreads or NPTL.<br>
<br>
This means our libpthread has gone, along with the bugs associated<br>
with it.  Valgrind now supports the kernel's threading syscalls, and<br>
lets you use your standard system libpthread.  As a result:<br>
<br>
* There are many fewer system dependencies and strange library-related<br>
  bugs.  There is a small performance improvement, and a large<br>
  stability improvement.<br>
<br>
* On the downside, Valgrind can no longer report misuses of the POSIX<br>
  PThreads API.  It also means that Helgrind currently does not work.<br>
  We hope to fix these problems in a future release.<br>
<br>
Note that running the native thread libraries does not mean Valgrind<br>
is able to provide genuine concurrent execution on SMPs.  We still<br>
impose the restriction that only one thread is running at any given<br>
time.<br>
<br>
There are many other significant changes too:<br>
<br>
* Memcheck is (once again) the default tool.<br>
<br>
* The default stack backtrace is now 12 call frames, rather than 4.<br>
<br>
* Suppressions can have up to 25 call frame matches, rather than 4.<br>
<br>
* Memcheck and Addrcheck use less memory.  Under some circumstances,<br>
  they no longer allocate shadow memory if there are large regions of<br>
  memory with the same A/V states - such as an mmaped file.<br>
<br>
* The memory-leak detector in Memcheck and Addrcheck has been<br>
  improved.  It now reports more types of memory leak, including<br>
  leaked cycles.  When reporting leaked memory, it can distinguish<br>
  between directly leaked memory (memory with no references), and<br>
  indirectly leaked memory (memory only referred to by other leaked<br>
  memory).<br>
<br>
* Memcheck's confusion over the effect of mprotect() has been fixed:<br>
  previously mprotect could erroneously mark undefined data as<br>
  defined.<br>
<br>
* Signal handling is much improved and should be very close to what<br>
  you get when running natively.  <br>
<br>
  One result of this is that Valgrind observes changes to sigcontexts<br>
  passed to signal handlers.  Such modifications will take effect when<br>
  the signal returns.  You will need to run with --single-step=yes to<br>
  make this useful.<br>
<br>
* Valgrind is built in Position Independent Executable (PIE) format if<br>
  your toolchain supports it.  This allows it to take advantage of all<br>
  the available address space on systems with 4Gbyte user address<br>
  spaces.<br>
<br>
* Valgrind can now run itself (requires PIE support).<br>
<br>
* Syscall arguments are now checked for validity.  Previously all<br>
  memory used by syscalls was checked, but now the actual values<br>
  passed are also checked.<br>
<br>
* Syscall wrappers are more robust against bad addresses being passed<br>
  to syscalls: they will fail with EFAULT rather than killing Valgrind<br>
  with SIGSEGV.<br>
<br>
* Because clone() is directly supported, some non-pthread uses of it<br>
  will work.  Partial sharing (where some resources are shared, and<br>
  some are not) is not supported.<br>
<br>
* open() and readlink() on /proc/self/exe are supported.<br>
<br>
BUGS FIXED:<br>
<br>
88520   pipe+fork+dup2 kills the main program<br>
88604 	Valgrind Aborts when using $VALGRIND_OPTS and user progra...<br>
88614 	valgrind: vg_libpthread.c:2323 (read): Assertion `read_pt...<br>
88703 	Stabs parser fails to handle ";"<br>
88886 	ioctl wrappers for TIOCMBIS and TIOCMBIC<br>
89032 	valgrind pthread_cond_timedwait fails<br>
89106 	the 'impossible' happened<br>
89139 	Missing sched_setaffinity &amp; sched_getaffinity<br>
89198 	valgrind lacks support for SIOCSPGRP and SIOCGPGRP<br>
89263 	Missing ioctl translations for scsi-generic and CD playing<br>
89440 	tests/deadlock.c line endings<br>
89481 	`impossible' happened: EXEC FAILED<br>
89663 	valgrind 2.2.0 crash on Redhat 7.2<br>
89792 	Report pthread_mutex_lock() deadlocks instead of returnin...<br>
90111 	statvfs64 gives invalid error/warning<br>
90128 	crash+memory fault with stabs generated by gnat for a run...<br>
90778 	VALGRIND_CHECK_DEFINED() not as documented in memcheck.h<br>
90834 	cachegrind crashes at end of program without reporting re...<br>
91028 	valgrind: vg_memory.c:229 (vgPlain_unmap_range): Assertio...<br>
91162 	valgrind crash while debugging drivel 1.2.1<br>
91199 	Unimplemented function<br>
91325 	Signal routing does not propagate the siginfo structure<br>
91599 	Assertion `cv == ((void *)0)'<br>
91604 	rw_lookup clears orig and sends the NULL value to rw_new<br>
91821 	Small problems building valgrind with $top_builddir ne $t...<br>
91844 	signal 11 (SIGSEGV) at get_tcb (libpthread.c:86) in corec...<br>
92264 	UNIMPLEMENTED FUNCTION: pthread_condattr_setpshared<br>
92331 	per-target flags necessitate AM_PROG_CC_C_O<br>
92420 	valgrind doesn't compile with linux 2.6.8.1/9<br>
92513 	Valgrind 2.2.0 generates some warning messages<br>
92528 	vg_symtab2.c:170 (addLoc): Assertion `loc-&gt;size &gt; 0' failed.<br>
93096 	unhandled ioctl 0x4B3A and 0x5601<br>
93117 	Tool and core interface versions do not match<br>
93128 	Can't run valgrind --tool=memcheck because of unimplement...<br>
93174 	Valgrind can crash if passed bad args to certain syscalls<br>
93309 	Stack frame in new thread is badly aligned<br>
93328 	Wrong types used with sys_sigprocmask()<br>
93763 	/usr/include/asm/msr.h is missing<br>
93776 	valgrind: vg_memory.c:508 (vgPlain_find_map_space): Asser...<br>
93810 	fcntl() argument checking a bit too strict<br>
94378 	Assertion `tst-&gt;sigqueue_head != tst-&gt;sigqueue_tail' failed.<br>
94429 	valgrind 2.2.0 segfault with mmap64 in glibc 2.3.3<br>
94645 	Impossible happened: PINSRW mem<br>
94953 	valgrind: the `impossible' happened: SIGSEGV<br>
95667 	Valgrind does not work with any KDE app<br>
96243 	Assertion 'res==0' failed<br>
96252 	stage2 loader of valgrind fails to allocate memory<br>
96520 	All programs crashing at _dl_start (in /lib/ld-2.3.3.so) ...<br>
96660 	ioctl CDROMREADTOCENTRY causes bogus warnings<br>
96747 	After looping in a segfault handler, the impossible happens<br>
96923 	Zero sized arrays crash valgrind trace back with SIGFPE<br>
96948 	valgrind stops with assertion failure regarding mmap2<br>
96966 	valgrind fails when application opens more than 16 sockets<br>
97398 	valgrind: vg_libpthread.c:2667 Assertion failed<br>
97407 	valgrind: vg_mylibc.c:1226 (vgPlain_safe_fd): Assertion `...<br>
97427 	"Warning: invalid file descriptor -1 in syscall close()" ...<br>
97785 	missing backtrace<br>
97792 	build in obj dir fails - autoconf / makefile cleanup<br>
97880 	pthread_mutex_lock fails from shared library (special ker...<br>
97975 	program aborts without ang VG messages<br>
98129 	Failed when open and close file 230000 times using stdio<br>
98175 	Crashes when using valgrind-2.2.0 with a program using al...<br>
98288 	Massif broken<br>
98303 	UNIMPLEMENTED FUNCTION pthread_condattr_setpshared<br>
98630 	failed--compilation missing warnings.pm, fails to make he...<br>
98756 	Cannot valgrind signal-heavy kdrive X server<br>
98966 	valgrinding the JVM fails with a sanity check assertion<br>
99035 	Valgrind crashes while profiling<br>
99142 	loops with message "Signal 11 being dropped from thread 0...<br>
99195 	threaded apps crash on thread start (using QThread::start...<br>
99348 	Assertion `vgPlain_lseek(core_fd, 0, 1) == phdrs[i].p_off...<br>
99568 	False negative due to mishandling of mprotect<br>
99738 	valgrind memcheck crashes on program that uses sigitimer<br>
99923 	0-sized allocations are reported as leaks<br>
99949 	program seg faults after exit()<br>
100036 	"newSuperblock's request for 1048576 bytes failed"<br>
100116 	valgrind: (pthread_cond_init): Assertion `sizeof(* cond) ...<br>
100486 	memcheck reports "valgrind: the `impossible' happened: V...<br>
100833 	second call to "mremap" fails with EINVAL<br>
101156 	(vgPlain_find_map_space): Assertion `(addr &amp; ((1 &lt;&lt; 12)-1...<br>
101173 	Assertion `recDepth &gt;= 0 &amp;&amp; recDepth &lt; 500' failed<br>
101291 	creating threads in a forked process fails<br>
101313 	valgrind causes different behavior when resizing a window...<br>
101423 	segfault for c++ array of floats<br>
101562 	valgrind massif dies on SIGINT even with signal handler r...<br>
<br>
<br>
Stable release 2.2.0 (31 August 2004) -- CHANGES RELATIVE TO 2.0.0<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
2.2.0 brings nine months worth of improvements and bug fixes.  We<br>
believe it to be a worthy successor to 2.0.0.  There are literally<br>
hundreds of bug fixes and minor improvements.  There are also some<br>
fairly major user-visible changes:<br>
<br>
* A complete overhaul of handling of system calls and signals, and <br>
  their interaction with threads.  In general, the accuracy of the <br>
  system call, thread and signal simulations is much improved:<br>
<br>
  - Blocking system calls behave exactly as they do when running<br>
    natively (not on valgrind).  That is, if a syscall blocks only the<br>
    calling thread when running natively, than it behaves the same on<br>
    valgrind.  No more mysterious hangs because V doesn't know that some<br>
    syscall or other, should block only the calling thread.<br>
<br>
  - Interrupted syscalls should now give more faithful results.<br>
<br>
  - Signal contexts in signal handlers are supported.<br>
<br>
* Improvements to NPTL support to the extent that V now works <br>
  properly on NPTL-only setups.<br>
<br>
* Greater isolation between Valgrind and the program being run, so<br>
  the program is less likely to inadvertently kill Valgrind by<br>
  doing wild writes.<br>
<br>
* Massif: a new space profiling tool.  Try it!  It's cool, and it'll<br>
  tell you in detail where and when your C/C++ code is allocating heap.<br>
  Draws pretty .ps pictures of memory use against time.  A potentially<br>
  powerful tool for making sense of your program's space use.<br>
<br>
* File descriptor leakage checks.  When enabled, Valgrind will print out<br>
  a list of open file descriptors on exit.<br>
<br>
* Improved SSE2/SSE3 support.<br>
<br>
* Time-stamped output; use --time-stamp=yes<br>
<br>
<br>
<br>
Stable release 2.2.0 (31 August 2004) -- CHANGES RELATIVE TO 2.1.2<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
2.2.0 is not much different from 2.1.2, released seven weeks ago.<br>
A number of bugs have been fixed, most notably #85658, which gave<br>
problems for quite a few people.  There have been many internal<br>
cleanups, but those are not user visible.<br>
<br>
The following bugs have been fixed since 2.1.2:<br>
<br>
85658   Assert in coregrind/vg_libpthread.c:2326 (open64) !=<br>
        (void*)0 failed<br>
        This bug was reported multiple times, and so the following<br>
        duplicates of it are also fixed: 87620, 85796, 85935, 86065, <br>
        86919, 86988, 87917, 88156<br>
<br>
80716   Semaphore mapping bug caused by unmap (sem_destroy)<br>
        (Was fixed prior to 2.1.2)<br>
<br>
86987   semctl and shmctl syscalls family is not handled properly<br>
<br>
86696   valgrind 2.1.2 + RH AS2.1 + librt<br>
<br>
86730   valgrind locks up at end of run with assertion failure <br>
        in __pthread_unwind<br>
<br>
86641   memcheck doesn't work with Mesa OpenGL/ATI on Suse 9.1<br>
        (also fixes 74298, a duplicate of this)<br>
<br>
85947   MMX/SSE unhandled instruction 'sfence'<br>
<br>
84978   Wrong error "Conditional jump or move depends on<br>
        uninitialised value" resulting from "sbbl %reg, %reg"<br>
<br>
86254   ssort() fails when signed int return type from comparison is <br>
        too small to handle result of unsigned int subtraction<br>
<br>
87089   memalign( 4, xxx) makes valgrind assert<br>
<br>
86407   Add support for low-level parallel port driver ioctls.<br>
<br>
70587   Add timestamps to Valgrind output? (wishlist)<br>
<br>
84937   vg_libpthread.c:2505 (se_remap): Assertion `res == 0'<br>
        (fixed prior to 2.1.2)<br>
<br>
86317   cannot load libSDL-1.2.so.0 using valgrind<br>
<br>
86989   memcpy from mac_replace_strmem.c complains about<br>
        uninitialized pointers passed when length to copy is zero<br>
<br>
85811   gnu pascal symbol causes segmentation fault; ok in 2.0.0<br>
<br>
79138   writing to sbrk()'d memory causes segfault<br>
<br>
77369   sched deadlock while signal received during pthread_join<br>
        and the joined thread exited<br>
<br>
88115   In signal handler for SIGFPE,  siginfo-&gt;si_addr is wrong <br>
        under Valgrind<br>
<br>
78765   Massif crashes on app exit if FP exceptions are enabled<br>
<br>
Additionally there are the following changes, which are not <br>
connected to any bug report numbers, AFAICS:<br>
<br>
* Fix scary bug causing mis-identification of SSE stores vs<br>
  loads and so causing memcheck to sometimes give nonsense results<br>
  on SSE code.<br>
<br>
* Add support for the POSIX message queue system calls.<br>
<br>
* Fix to allow 32-bit Valgrind to run on AMD64 boxes.  Note: this does<br>
  NOT allow Valgrind to work with 64-bit executables - only with 32-bit<br>
  executables on an AMD64 box.<br>
<br>
* At configure time, only check whether linux/mii.h can be processed <br>
  so that we don't generate ugly warnings by trying to compile it.<br>
<br>
* Add support for POSIX clocks and timers.<br>
<br>
<br>
<br>
Developer (cvs head) release 2.1.2 (18 July 2004)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
2.1.2 contains four months worth of bug fixes and refinements.<br>
Although officially a developer release, we believe it to be stable<br>
enough for widespread day-to-day use.  2.1.2 is pretty good, so try it<br>
first, although there is a chance it won't work.  If so then try 2.0.0<br>
and tell us what went wrong."  2.1.2 fixes a lot of problems present<br>
in 2.0.0 and is generally a much better product.<br>
<br>
Relative to 2.1.1, a large number of minor problems with 2.1.1 have<br>
been fixed, and so if you use 2.1.1 you should try 2.1.2.  Users of<br>
the last stable release, 2.0.0, might also want to try this release.<br>
<br>
The following bugs, and probably many more, have been fixed.  These<br>
are listed at http://bugs.kde.org.  Reporting a bug for valgrind in<br>
the http://bugs.kde.org is much more likely to get you a fix than<br>
mailing developers directly, so please continue to keep sending bugs<br>
there.<br>
<br>
76869   Crashes when running any tool under Fedora Core 2 test1<br>
        This fixes the problem with returning from a signal handler <br>
        when VDSOs are turned off in FC2.<br>
<br>
69508   java 1.4.2 client fails with erroneous "stack size too small".<br>
        This fix makes more of the pthread stack attribute related <br>
        functions work properly.  Java still doesn't work though.<br>
<br>
71906   malloc alignment should be 8, not 4<br>
        All memory returned by malloc/new etc is now at least<br>
        8-byte aligned.<br>
<br>
81970   vg_alloc_ThreadState: no free slots available<br>
        (closed because the workaround is simple: increase<br>
         VG_N_THREADS, rebuild and try again.)<br>
<br>
78514   Conditional jump or move depends on uninitialized value(s)<br>
        (a slight mishanding of FP code in memcheck)<br>
<br>
77952   pThread Support (crash) (due to initialisation-ordering probs)<br>
        (also 85118)<br>
<br>
80942   Addrcheck wasn't doing overlap checking as it should.<br>
78048   return NULL on malloc/new etc failure, instead of asserting<br>
73655   operator new() override in user .so files often doesn't get picked up<br>
83060   Valgrind does not handle native kernel AIO<br>
69872   Create proper coredumps after fatal signals<br>
82026   failure with new glibc versions: __libc_* functions are not exported<br>
70344   UNIMPLEMENTED FUNCTION: tcdrain <br>
81297   Cancellation of pthread_cond_wait does not require mutex<br>
82872   Using debug info from additional packages (wishlist)<br>
83025   Support for ioctls FIGETBSZ and FIBMAP<br>
83340   Support for ioctl HDIO_GET_IDENTITY<br>
79714   Support for the semtimedop system call.<br>
77022   Support for ioctls FBIOGET_VSCREENINFO and FBIOGET_FSCREENINFO<br>
82098   hp2ps ansification (wishlist)<br>
83573   Valgrind SIGSEGV on execve<br>
82999   show which cmdline option was erroneous (wishlist)<br>
83040   make valgrind VPATH and distcheck-clean (wishlist)<br>
83998   Assertion `newfd &gt; vgPlain_max_fd' failed (see below)<br>
82722   Unchecked mmap in as_pad leads to mysterious failures later<br>
78958   memcheck seg faults while running Mozilla <br>
85416   Arguments with colon (e.g. --logsocket) ignored<br>
<br>
<br>
Additionally there are the following changes, which are not <br>
connected to any bug report numbers, AFAICS:<br>
<br>
* Rearranged address space layout relative to 2.1.1, so that<br>
  Valgrind/tools will run out of memory later than currently in many<br>
  circumstances.  This is good news esp. for Calltree.  It should<br>
  be possible for client programs to allocate over 800MB of<br>
  memory when using memcheck now.<br>
<br>
* Improved checking when laying out memory.  Should hopefully avoid<br>
  the random segmentation faults that 2.1.1 sometimes caused.<br>
<br>
* Support for Fedora Core 2 and SuSE 9.1.  Improvements to NPTL<br>
  support to the extent that V now works properly on NPTL-only setups.<br>
<br>
* Renamed the following options:<br>
  --logfile-fd  --&gt;  --log-fd<br>
  --logfile     --&gt;  --log-file<br>
  --logsocket   --&gt;  --log-socket<br>
  to be consistent with each other and other options (esp. --input-fd).<br>
<br>
* Add support for SIOCGMIIPHY, SIOCGMIIREG and SIOCSMIIREG ioctls and<br>
  improve the checking of other interface related ioctls.<br>
<br>
* Fix building with gcc-3.4.1.<br>
<br>
* Remove limit on number of semaphores supported.<br>
<br>
* Add support for syscalls: set_tid_address (258), acct (51).<br>
<br>
* Support instruction "repne movs" -- not official but seems to occur.<br>
<br>
* Implement an emulated soft limit for file descriptors in addition to<br>
  the current reserved area, which effectively acts as a hard limit. The<br>
  setrlimit system call now simply updates the emulated limits as best<br>
  as possible - the hard limit is not allowed to move at all and just<br>
  returns EPERM if you try and change it.  This should stop reductions<br>
  in the soft limit causing assertions when valgrind tries to allocate<br>
  descriptors from the reserved area.<br>
  (This actually came from bug #83998).<br>
<br>
* Major overhaul of Cachegrind implementation.  First user-visible change<br>
  is that cachegrind.out files are now typically 90% smaller than they<br>
  used to be;  code annotation times are correspondingly much smaller.<br>
  Second user-visible change is that hit/miss counts for code that is<br>
  unloaded at run-time is no longer dumped into a single "discard" pile,<br>
  but accurately preserved.<br>
<br>
* Client requests for telling valgrind about memory pools.<br>
<br>
<br>
<br>
Developer (cvs head) release 2.1.1 (12 March 2004)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
2.1.1 contains some internal structural changes needed for V's<br>
long-term future.  These don't affect end-users.  Most notable<br>
user-visible changes are:<br>
<br>
* Greater isolation between Valgrind and the program being run, so<br>
  the program is less likely to inadvertently kill Valgrind by<br>
  doing wild writes.<br>
<br>
* Massif: a new space profiling tool.  Try it!  It's cool, and it'll<br>
  tell you in detail where and when your C/C++ code is allocating heap.<br>
  Draws pretty .ps pictures of memory use against time.  A potentially<br>
  powerful tool for making sense of your program's space use.<br>
<br>
* Fixes for many bugs, including support for more SSE2/SSE3 instructions,<br>
  various signal/syscall things, and various problems with debug<br>
  info readers.<br>
<br>
* Support for glibc-2.3.3 based systems.<br>
<br>
We are now doing automatic overnight build-and-test runs on a variety<br>
of distros.  As a result, we believe 2.1.1 builds and runs on:<br>
Red Hat 7.2, 7.3, 8.0, 9, Fedora Core 1, SuSE 8.2, SuSE 9.<br>
<br>
<br>
The following bugs, and probably many more, have been fixed.  These<br>
are listed at http://bugs.kde.org.  Reporting a bug for valgrind in<br>
the http://bugs.kde.org is much more likely to get you a fix than<br>
mailing developers directly, so please continue to keep sending bugs<br>
there.<br>
<br>
69616   glibc 2.3.2 w/NPTL is massively different than what valgrind expects <br>
69856   I don't know how to instrument MMXish stuff (Helgrind)<br>
73892   valgrind segfaults starting with Objective-C debug info <br>
        (fix for S-type stabs)<br>
73145   Valgrind complains too much about close(&lt;reserved fd&gt;) <br>
73902   Shadow memory allocation seems to fail on RedHat 8.0 <br>
68633   VG_N_SEMAPHORES too low (V itself was leaking semaphores)<br>
75099   impossible to trace multiprocess programs <br>
76839   the `impossible' happened: disInstr: INT but not 0x80 ! <br>
76762   vg_to_ucode.c:3748 (dis_push_segreg): Assertion `sz == 4' failed. <br>
76747   cannot include valgrind.h in c++ program <br>
76223   parsing B(3,10) gave NULL type =&gt; impossible happens <br>
75604   shmdt handling problem <br>
76416   Problems with gcc 3.4 snap 20040225 <br>
75614   using -gstabs when building your programs the `impossible' happened<br>
75787   Patch for some CDROM ioctls CDORM_GET_MCN, CDROM_SEND_PACKET,<br>
75294   gcc 3.4 snapshot's libstdc++ have unsupported instructions. <br>
        (REP RET)<br>
73326   vg_symtab2.c:272 (addScopeRange): Assertion `range-&gt;size &gt; 0' failed. <br>
72596   not recognizing __libc_malloc <br>
69489   Would like to attach ddd to running program <br>
72781   Cachegrind crashes with kde programs <br>
73055   Illegal operand at DXTCV11CompressBlockSSE2 (more SSE opcodes)<br>
73026   Descriptor leak check reports port numbers wrongly <br>
71705   README_MISSING_SYSCALL_OR_IOCTL out of date <br>
72643   Improve support for SSE/SSE2 instructions <br>
72484   valgrind leaves it's own signal mask in place when execing <br>
72650   Signal Handling always seems to restart system calls <br>
72006   The mmap system call turns all errors in ENOMEM <br>
71781   gdb attach is pretty useless <br>
71180   unhandled instruction bytes: 0xF 0xAE 0x85 0xE8 <br>
69886   writes to zero page cause valgrind to assert on exit <br>
71791   crash when valgrinding gimp 1.3 (stabs reader problem)<br>
69783   unhandled syscall: 218 <br>
69782   unhandled instruction bytes: 0x66 0xF 0x2B 0x80 <br>
70385   valgrind fails if the soft file descriptor limit is less <br>
        than about 828<br>
69529   "rep; nop" should do a yield <br>
70827   programs with lots of shared libraries report "mmap failed" <br>
        for some of them when reading symbols <br>
71028   glibc's strnlen is optimised enough to confuse valgrind <br>
<br>
<br>
<br>
<br>
Unstable (cvs head) release 2.1.0 (15 December 2003)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
For whatever it's worth, 2.1.0 actually seems pretty darn stable to me<br>
(Julian).  It looks eminently usable, and given that it fixes some<br>
significant bugs, may well be worth using on a day-to-day basis.<br>
2.1.0 is known to build and pass regression tests on: SuSE 9, SuSE<br>
8.2, RedHat 8.<br>
<br>
2.1.0 most notably includes Jeremy Fitzhardinge's complete overhaul of<br>
handling of system calls and signals, and their interaction with<br>
threads.  In general, the accuracy of the system call, thread and<br>
signal simulations is much improved.  Specifically:<br>
<br>
- Blocking system calls behave exactly as they do when running<br>
  natively (not on valgrind).  That is, if a syscall blocks only the<br>
  calling thread when running natively, than it behaves the same on<br>
  valgrind.  No more mysterious hangs because V doesn't know that some<br>
  syscall or other, should block only the calling thread.<br>
<br>
- Interrupted syscalls should now give more faithful results.<br>
<br>
- Finally, signal contexts in signal handlers are supported.  As a<br>
  result, konqueror on SuSE 9 no longer segfaults when notified of<br>
  file changes in directories it is watching.<br>
<br>
Other changes:<br>
<br>
- Robert Walsh's file descriptor leakage checks.  When enabled,<br>
  Valgrind will print out a list of open file descriptors on<br>
  exit.  Along with each file descriptor, Valgrind prints out a stack<br>
  backtrace of where the file was opened and any details relating to the<br>
  file descriptor such as the file name or socket details.<br>
  To use, give: --track-fds=yes<br>
<br>
- Implemented a few more SSE/SSE2 instructions.<br>
<br>
- Less crud on the stack when you do 'where' inside a GDB attach.<br>
<br>
- Fixed the following bugs:<br>
  68360: Valgrind does not compile against 2.6.0-testX kernels<br>
  68525: CVS head doesn't compile on C90 compilers<br>
  68566: pkgconfig support (wishlist)<br>
  68588: Assertion `sz == 4' failed in vg_to_ucode.c (disInstr)<br>
  69140: valgrind not able to explicitly specify a path to a binary. <br>
  69432: helgrind asserts encountering a MutexErr when there are <br>
         EraserErr suppressions<br>
<br>
- Increase the max size of the translation cache from 200k average bbs<br>
  to 300k average bbs.  Programs on the size of OOo (680m17) are<br>
  thrashing the cache at the smaller size, creating large numbers of<br>
  retranslations and wasting significant time as a result.<br>
<br>
<br>
<br>
Stable release 2.0.0 (5 Nov 2003)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
2.0.0 improves SSE/SSE2 support, fixes some minor bugs, and<br>
improves support for SuSE 9 and the Red Hat "Severn" beta.<br>
<br>
- Further improvements to SSE/SSE2 support.  The entire test suite of<br>
  the GNU Scientific Library (gsl-1.4) compiled with Intel Icc 7.1<br>
  20030307Z '-g -O -xW' now works.  I think this gives pretty good<br>
  coverage of SSE/SSE2 floating point instructions, or at least the<br>
  subset emitted by Icc.<br>
<br>
- Also added support for the following instructions:<br>
    MOVNTDQ UCOMISD UNPCKLPS UNPCKHPS SQRTSS<br>
    PUSH/POP %{FS,GS}, and PUSH %CS (Nb: there is no POP %CS).<br>
<br>
- CFI support for GDB version 6.  Needed to enable newer GDBs<br>
  to figure out where they are when using --gdb-attach=yes.<br>
<br>
- Fix this:<br>
      mc_translate.c:1091 (memcheck_instrument): Assertion<br>
      `u_in-&gt;size == 4 || u_in-&gt;size == 16' failed.<br>
<br>
- Return an error rather than panicing when given a bad socketcall.<br>
<br>
- Fix checking of syscall rt_sigtimedwait().<br>
<br>
- Implement __NR_clock_gettime (syscall 265).  Needed on Red Hat Severn.<br>
<br>
- Fixed bug in overlap check in strncpy() -- it was assuming the src was 'n'<br>
  bytes long, when it could be shorter, which could cause false<br>
  positives.<br>
<br>
- Support use of select() for very large numbers of file descriptors.<br>
<br>
- Don't fail silently if the executable is statically linked, or is<br>
  setuid/setgid. Print an error message instead.<br>
<br>
- Support for old DWARF-1 format line number info.<br>
<br>
<br>
<br>
Snapshot 20031012 (12 October 2003)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
Three months worth of bug fixes, roughly.  Most significant single<br>
change is improved SSE/SSE2 support, mostly thanks to Dirk Mueller.<br>
<br>
20031012 builds on Red Hat Fedora ("Severn") but doesn't really work<br>
(curiosly, mozilla runs OK, but a modest "ls -l" bombs).  I hope to<br>
get a working version out soon.  It may or may not work ok on the<br>
forthcoming SuSE 9; I hear positive noises about it but haven't been<br>
able to verify this myself (not until I get hold of a copy of 9).<br>
<br>
A detailed list of changes, in no particular order:<br>
<br>
- Describe --gen-suppressions in the FAQ.<br>
<br>
- Syscall __NR_waitpid supported.<br>
<br>
- Minor MMX bug fix.<br>
<br>
- -v prints program's argv[] at startup.<br>
<br>
- More glibc-2.3 suppressions.<br>
<br>
- Suppressions for stack underrun bug(s) in the c++ support library<br>
  distributed with Intel Icc 7.0.<br>
<br>
- Fix problems reading /proc/self/maps.<br>
<br>
- Fix a couple of messages that should have been suppressed by -q, <br>
  but weren't.<br>
<br>
- Make Addrcheck understand "Overlap" suppressions.<br>
<br>
- At startup, check if program is statically linked and bail out if so.<br>
<br>
- Cachegrind: Auto-detect Intel Pentium-M, also VIA Nehemiah<br>
<br>
- Memcheck/addrcheck: minor speed optimisations<br>
<br>
- Handle syscall __NR_brk more correctly than before.<br>
<br>
- Fixed incorrect allocate/free mismatch errors when using<br>
  operator new(unsigned, std::nothrow_t const&amp;)<br>
  operator new[](unsigned, std::nothrow_t const&amp;)<br>
<br>
- Support POSIX pthread spinlocks.<br>
<br>
- Fixups for clean compilation with gcc-3.3.1.<br>
<br>
- Implemented more opcodes: <br>
    - push %es<br>
    - push %ds<br>
    - pop %es<br>
    - pop %ds<br>
    - movntq<br>
    - sfence<br>
    - pshufw<br>
    - pavgb<br>
    - ucomiss<br>
    - enter<br>
    - mov imm32, %esp<br>
    - all "in" and "out" opcodes<br>
    - inc/dec %esp<br>
    - A whole bunch of SSE/SSE2 instructions<br>
<br>
- Memcheck: don't bomb on SSE/SSE2 code.<br>
<br>
<br>
Snapshot 20030725 (25 July 2003)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
Fixes some minor problems in 20030716.<br>
<br>
- Fix bugs in overlap checking for strcpy/memcpy etc.<br>
<br>
- Do overlap checking with Addrcheck as well as Memcheck.<br>
<br>
- Fix this:<br>
      Memcheck: the `impossible' happened:<br>
      get_error_name: unexpected type<br>
<br>
- Install headers needed to compile new skins.<br>
<br>
- Remove leading spaces and colon in the LD_LIBRARY_PATH / LD_PRELOAD<br>
  passed to non-traced children.<br>
<br>
- Fix file descriptor leak in valgrind-listener.<br>
<br>
- Fix longstanding bug in which the allocation point of a <br>
  block resized by realloc was not correctly set.  This may<br>
  have caused confusing error messages.<br>
<br>
<br>
Snapshot 20030716 (16 July 2003)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
20030716 is a snapshot of our current CVS head (development) branch.<br>
This is the branch which will become valgrind-2.0.  It contains<br>
significant enhancements over the 1.9.X branch.<br>
<br>
Despite this being a snapshot of the CVS head, it is believed to be<br>
quite stable -- at least as stable as 1.9.6 or 1.0.4, if not more so<br>
-- and therefore suitable for widespread use.  Please let us know asap<br>
if it causes problems for you.<br>
<br>
Two reasons for releasing a snapshot now are:<br>
<br>
- It's been a while since 1.9.6, and this snapshot fixes<br>
  various problems that 1.9.6 has with threaded programs <br>
  on glibc-2.3.X based systems.<br>
<br>
- So as to make available improvements in the 2.0 line.<br>
<br>
Major changes in 20030716, as compared to 1.9.6:<br>
<br>
- More fixes to threading support on glibc-2.3.1 and 2.3.2-based<br>
  systems (SuSE 8.2, Red Hat 9).  If you have had problems<br>
  with inconsistent/illogical behaviour of errno, h_errno or the DNS<br>
  resolver functions in threaded programs, 20030716 should improve<br>
  matters.  This snapshot seems stable enough to run OpenOffice.org<br>
  1.1rc on Red Hat 7.3, SuSE 8.2 and Red Hat 9, and that's a big<br>
  threaded app if ever I saw one.<br>
<br>
- Automatic generation of suppression records; you no longer<br>
  need to write them by hand.  Use --gen-suppressions=yes.<br>
<br>
- strcpy/memcpy/etc check their arguments for overlaps, when<br>
  running with the Memcheck or Addrcheck skins.<br>
<br>
- malloc_usable_size() is now supported.<br>
<br>
- new client requests:<br>
    - VALGRIND_COUNT_ERRORS, VALGRIND_COUNT_LEAKS: <br>
      useful with regression testing<br>
    - VALGRIND_NON_SIMD_CALL[0123]: for running arbitrary functions <br>
      on real CPU (use with caution!)<br>
<br>
- The GDB attach mechanism is more flexible.  Allow the GDB to<br>
  be run to be specified by --gdb-path=/path/to/gdb, and specify<br>
  which file descriptor V will read its input from with<br>
  --input-fd=&lt;number&gt;.<br>
<br>
- Cachegrind gives more accurate results (wasn't tracking instructions in<br>
  malloc() and friends previously, is now).<br>
<br>
- Complete support for the MMX instruction set.<br>
<br>
- Partial support for the SSE and SSE2 instruction sets.  Work for this<br>
  is ongoing.  About half the SSE/SSE2 instructions are done, so<br>
  some SSE based programs may work.  Currently you need to specify<br>
  --skin=addrcheck.  Basically not suitable for real use yet.<br>
<br>
- Significant speedups (10%-20%) for standard memory checking.<br>
<br>
- Fix assertion failure in pthread_once().<br>
<br>
- Fix this:<br>
    valgrind: vg_intercept.c:598 (vgAllRoadsLeadToRome_select): <br>
              Assertion `ms_end &gt;= ms_now' failed.<br>
<br>
- Implement pthread_mutexattr_setpshared.<br>
<br>
- Understand Pentium 4 branch hints.  Also implemented a couple more<br>
  obscure x86 instructions.<br>
<br>
- Lots of other minor bug fixes.<br>
<br>
- We have a decent regression test system, for the first time.<br>
  This doesn't help you directly, but it does make it a lot easier<br>
  for us to track the quality of the system, especially across<br>
  multiple linux distributions.  <br>
<br>
  You can run the regression tests with 'make regtest' after 'make<br>
  install' completes.  On SuSE 8.2 and Red Hat 9 I get this:<br>
 <br>
     == 84 tests, 0 stderr failures, 0 stdout failures ==<br>
<br>
  On Red Hat 8, I get this:<br>
<br>
     == 84 tests, 2 stderr failures, 1 stdout failure ==<br>
     corecheck/tests/res_search               (stdout)<br>
     memcheck/tests/sigaltstack               (stderr)<br>
<br>
  sigaltstack is probably harmless.  res_search doesn't work<br>
  on R H 8 even running natively, so I'm not too worried.   <br>
<br>
  On Red Hat 7.3, a glibc-2.2.5 system, I get these harmless failures:<br>
<br>
     == 84 tests, 2 stderr failures, 1 stdout failure ==<br>
     corecheck/tests/pth_atfork1              (stdout)<br>
     corecheck/tests/pth_atfork1              (stderr)<br>
     memcheck/tests/sigaltstack               (stderr)<br>
<br>
  You need to run on a PII system, at least, since some tests<br>
  contain P6-specific instructions, and the test machine needs<br>
  access to the internet so that corecheck/tests/res_search<br>
  (a test that the DNS resolver works) can function.<br>
<br>
As ever, thanks for the vast amount of feedback :) and bug reports :(<br>
We may not answer all messages, but we do at least look at all of<br>
them, and tend to fix the most frequently reported bugs.<br>
<br>
<br>
<br>
Version 1.9.6 (7 May 2003 or thereabouts)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
Major changes in 1.9.6:<br>
<br>
- Improved threading support for glibc &gt;= 2.3.2 (SuSE 8.2,<br>
  RedHat 9, to name but two ...)  It turned out that 1.9.5<br>
  had problems with threading support on glibc &gt;= 2.3.2,<br>
  usually manifested by threaded programs deadlocking in system calls,<br>
  or running unbelievably slowly.  Hopefully these are fixed now.  1.9.6<br>
  is the first valgrind which gives reasonable support for<br>
  glibc-2.3.2.  Also fixed a 2.3.2 problem with pthread_atfork().<br>
<br>
- Majorly expanded FAQ.txt.  We've added workarounds for all<br>
  common problems for which a workaround is known.<br>
<br>
Minor changes in 1.9.6:<br>
<br>
- Fix identification of the main thread's stack.  Incorrect<br>
  identification of it was causing some on-stack addresses to not get<br>
  identified as such.  This only affected the usefulness of some error<br>
  messages; the correctness of the checks made is unchanged.<br>
<br>
- Support for kernels &gt;= 2.5.68.<br>
<br>
- Dummy implementations of __libc_current_sigrtmin, <br>
  __libc_current_sigrtmax and __libc_allocate_rtsig, hopefully<br>
  good enough to keep alive programs which previously died for lack of<br>
  them.<br>
<br>
- Fix bug in the VALGRIND_DISCARD_TRANSLATIONS client request.<br>
<br>
- Fix bug in the DWARF2 debug line info loader, when instructions <br>
  following each other have source lines far from each other <br>
  (e.g. with inlined functions).<br>
<br>
- Debug info reading: read symbols from both "symtab" and "dynsym"<br>
  sections, rather than merely from the one that comes last in the<br>
  file.<br>
<br>
- New syscall support: prctl(), creat(), lookup_dcookie().<br>
<br>
- When checking calls to accept(), recvfrom(), getsocketopt(),<br>
  don't complain if buffer values are NULL.<br>
<br>
- Try and avoid assertion failures in<br>
  mash_LD_PRELOAD_and_LD_LIBRARY_PATH.<br>
<br>
- Minor bug fixes in cg_annotate.<br>
<br>
<br>
<br>
Version 1.9.5 (7 April 2003)<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
It occurs to me that it would be helpful for valgrind users to record<br>
in the source distribution the changes in each release.  So I now<br>
attempt to mend my errant ways :-)  Changes in this and future releases<br>
will be documented in the NEWS file in the source distribution.<br>
<br>
Major changes in 1.9.5:<br>
<br>
- (Critical bug fix): Fix a bug in the FPU simulation.  This was<br>
  causing some floating point conditional tests not to work right.<br>
  Several people reported this.  If you had floating point code which<br>
  didn't work right on 1.9.1 to 1.9.4, it's worth trying 1.9.5.<br>
<br>
- Partial support for Red Hat 9.  RH9 uses the new Native Posix <br>
  Threads Library (NPTL), instead of the older LinuxThreads.  <br>
  This potentially causes problems with V which will take some<br>
  time to correct.  In the meantime we have partially worked around<br>
  this, and so 1.9.5 works on RH9.  Threaded programs still work,<br>
  but they may deadlock, because some system calls (accept, read,<br>
  write, etc) which should be nonblocking, in fact do block.  This<br>
  is a known bug which we are looking into.<br>
<br>
  If you can, your best bet (unfortunately) is to avoid using <br>
  1.9.5 on a Red Hat 9 system, or on any NPTL-based distribution.<br>
  If your glibc is 2.3.1 or earlier, you're almost certainly OK.<br>
<br>
Minor changes in 1.9.5:<br>
<br>
- Added some #errors to valgrind.h to ensure people don't include<br>
  it accidentally in their sources.  This is a change from 1.0.X<br>
  which was never properly documented.  The right thing to include<br>
  is now memcheck.h.  Some people reported problems and strange<br>
  behaviour when (incorrectly) including valgrind.h in code with <br>
  1.9.1 -- 1.9.4.  This is no longer possible.<br>
<br>
- Add some __extension__ bits and pieces so that gcc configured<br>
  for valgrind-checking compiles even with -Werror.  If you<br>
  don't understand this, ignore it.  Of interest to gcc developers<br>
  only.<br>
<br>
- Removed a pointless check which caused problems interworking <br>
  with Clearcase.  V would complain about shared objects whose<br>
  names did not end ".so", and refuse to run.  This is now fixed.<br>
  In fact it was fixed in 1.9.4 but not documented.<br>
<br>
- Fixed a bug causing an assertion failure of "waiters == 1"<br>
  somewhere in vg_scheduler.c, when running large threaded apps,<br>
  notably MySQL.<br>
<br>
- Add support for the munlock system call (124).<br>
<br>
Some comments about future releases:<br>
<br>
1.9.5 is, we hope, the most stable Valgrind so far.  It pretty much<br>
supersedes the 1.0.X branch.  If you are a valgrind packager, please<br>
consider making 1.9.5 available to your users.  You can regard the<br>
1.0.X branch as obsolete: 1.9.5 is stable and vastly superior.  There<br>
are no plans at all for further releases of the 1.0.X branch.<br>
<br>
If you want a leading-edge valgrind, consider building the cvs head<br>
(from SourceForge), or getting a snapshot of it.  Current cool stuff<br>
going in includes MMX support (done); SSE/SSE2 support (in progress),<br>
a significant (10-20%) performance improvement (done), and the usual<br>
large collection of minor changes.  Hopefully we will be able to<br>
improve our NPTL support, but no promises.<br>
<br>
<br>
    </p></div>
</div>
<div>
<br><table class="nav" width="100%" cellspacing="3" cellpadding="2" border="0" summary="Navigation footer">
<tr>
<td rowspan="2" width="40%" align="left">
<a accesskey="p" href="dist.install.html">&lt;&lt; 3. INSTALL</a> </td>
<td width="20%" align="center"><a accesskey="u" href="dist.html">Up</a></td>
<td rowspan="2" width="40%" align="right"> <a accesskey="n" href="dist.readme.html">5. README &gt;&gt;</a>
</td>
</tr>
<tr><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td></tr>
</table>
</div>
</body>
</html>
